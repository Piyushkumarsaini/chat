<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - In Chat</title>
<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background-color: #e5ddd5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .container {
    background-color: #fff;
    width: 380px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    overflow: hidden;
    padding: 25px;
    text-align: center;
    animation: fadeIn 0.8s ease;
    border-top: 8px solid #25d366;
    border-bottom: 8px solid #128c7e;
    position: relative;
  }

  h2 {
    color: #128c7e;
    margin-bottom: 10px;
    font-size: 1.6em;
  }

  h3 {
    color: #075e54;
    margin-bottom: 20px;
    font-weight: normal;
  }

  input[type="text"], input[type="number"] {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1em;
    outline: none;
    margin-top: 5px;
  }

  input:focus {
    border-color: #25d366;
    box-shadow: 0 0 0 2px rgba(37,211,102,0.2);
  }

  button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    background-color: #25d366;
    color: white;
    font-size: 1em;
    cursor: pointer;
    transition: background 0.3s;
    margin-top: 15px;
  }

  button:hover {
    background-color: #128c7e;
  }

  .hidden { display: none; }

  .message {
    text-align: center;
    font-size: 0.9em;
    margin: 10px 0;
  }

  .error { color: #d93025; }
  .success { color: #25d366; }

  p {
    font-size: 0.85em;
    margin-top: 15px;
  }

  a {
    color: #128c7e;
    text-decoration: none;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>
<div class="container">
  <h2>Welcome Back to In Chat</h2>
  <h3>Login to continue chatting</h3>

  <!-- Step 1: Phone -->
  <div id="phone-step">
    <label for="phoneNumber">Enter your phone number</label>
    <input type="text" id="phoneNumber" placeholder="e.g. 9876543210">
    <button onclick="sendOTP()">Send OTP</button>
  </div>

  <!-- Step 2: OTP -->
  <div id="otp-step" class="hidden">
    <h3>Verify OTP</h3>
    <label for="otp">Enter the 6-digit OTP sent to your number</label>
    <input type="text" id="otp" placeholder="Enter OTP">
    <button onclick="verifyOTP()">Verify OTP</button>
    <button id="resendOtp" style="margin-top:10px; background-color:#128c7e;">Resend OTP (<span id="timer">30</span>s)</button>
    <p id="resendMessage" class="message"></p>
  </div>

  <p id="message" class="message"></p>
  <p>New here? <a href="/api/signup/">Create an account</a></p>
</div>



<script>
let currentPhone = "";
let resendTimer;
let timerCount = 30;

// Step 1: Send OTP
function sendOTP() {
  currentPhone = document.getElementById('phoneNumber').value.trim();
  if (!currentPhone) return alert("Please enter your phone number.");
  
  fetch('/api/send-otp/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ number: currentPhone })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('message').textContent = data.message;
    if (data.status === 'success') {
      document.getElementById('phone-step').classList.add('hidden');
      document.getElementById('otp-step').classList.remove('hidden');
      startResendTimer();
    }
  });
}

// Step 2: Verify OTP
function verifyOTP() {
  const otp = document.getElementById('otp').value.trim();
  fetch('/api/verify-otp/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ otp })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('message').textContent = data.message;
    if (data.status === 'success') {
      window.location.href = data.redirect_url;
    }
  });
}

// Resend OTP button and countdown
const resendBtn = document.getElementById('resendOtp');
resendBtn.disabled = true;

resendBtn.addEventListener('click', () => {
  fetch('/api/send-otp/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ number: currentPhone })
  })
  .then(res => res.json())
  .then(data => {
    const msg = document.getElementById('resendMessage');
    if (data.status === 'success') {
      msg.textContent = "OTP resent successfully!";
      msg.className = "message success";
      startResendTimer();
    } else {
      msg.textContent = data.message || "Failed to resend OTP";
      msg.className = "message error";
    }
  });
});

function startResendTimer() {
  resendBtn.disabled = true;
  timerCount = 30;
  document.getElementById('timer').textContent = timerCount;
  clearInterval(resendTimer);
  resendTimer = setInterval(() => {
    timerCount--;
    document.getElementById('timer').textContent = timerCount;
    if (timerCount <= 0) {
      clearInterval(resendTimer);
      resendBtn.disabled = false;
      document.getElementById('timer').textContent = "0";
    }
  }, 1000);
}
</script>
</body>
</html>
